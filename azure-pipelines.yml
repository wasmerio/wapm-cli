trigger:
  - master

resources:
  containers:
    - container: rust133
      image: rust:1.33
jobs:
  - job: e2eRegressionTests
    pool:
      vmImage: 'ubuntu-16.04'
    strategy:
      matrix:
        rust133:
          containerResource: rust133
    container: $[ variables['containerResource'] ]
    steps:
      - script: |
          export PATH=$PATH:$HOME/.cargo/bin
          cargo build --verbose
        displayName: 'Build wapm'
      - script: |
          curl https://get.wasmer.io -sSfL | sh
          export PATH=$PATH:$HOME/.cargo/bin
          export PATH=$PATH:$HOME/.wasmer/bin
          export WAPM_DISABLE_COLOR=true
          chmod +x end-to-end-tests/install.sh
          ./end-to-end-tests/install.sh > /tmp/install-out.txt
          cat /tmp/install-out.txt
          echo "comparing"
          diff -B end-to-end-tests/install.txt /tmp/install-out.txt
        displayName: 'Install regression test'
